#version 410 core

//======================================================================
// BasicMesh.vert
// ・通常メッシュ用のベーシックな頂点シェーダ
// ・スキニングなし
// ・ワールド行列と ViewProj で位置を変換
// ・Phong や Toon など共通のフラグメントシェーダへ値を渡す
//======================================================================


//-----------------------------------------------------------------------
//  Uniforms
//-----------------------------------------------------------------------
// ワールド変換行列（モデル → ワールド）
uniform mat4 uWorldTransform;

// ビュー射影行列（ワールド → クリップ空間）
uniform mat4 uViewProj;


//-----------------------------------------------------------------------
//  Attributes（頂点属性）
//-----------------------------------------------------------------------
// layout(location = X) は VAO との対応
layout(location = 0) in vec3 inPosition;   // 頂点座標（ローカル）
layout(location = 1) in vec3 inNormal;     // 法線ベクトル（ローカル）
layout(location = 2) in vec2 inTexCoord;   // UV座標


//-----------------------------------------------------------------------
//  出力（Fragment Shader へ渡す）
//-----------------------------------------------------------------------
// ※視点空間ではなく「ワールド空間」で渡すのが ToyLib の基本設計
out vec2 fragTexCoord;     // UV座標
out vec3 fragNormal;       // ワールド法線
out vec3 fragWorldPos;     // 頂点のワールド座標


//-----------------------------------------------------------------------
//  main
//-----------------------------------------------------------------------
void main()
{
    // --------- ローカル → ワールド座標変換 ----------------------------
    vec4 worldPos = vec4(inPosition, 1.0) * uWorldTransform;

    // FSへ渡すワールド座標
    fragWorldPos = worldPos.xyz;

    // --------- ワールド法線の計算 --------------------------------------
    // mat3 でワールド行列の回転スケール部分だけ抽出し、正規化する
    fragNormal = normalize(mat3(uWorldTransform) * inNormal);

    // --------- クリップ空間への変換（描画用） ---------------------------
    gl_Position = worldPos * uViewProj;

    // --------- UV ------------------------------------------------------
    fragTexCoord = inTexCoord;
}
