#version 410 core

//======================================================================
//  Billboard.frag
//  ・ビルボード（2D スプライト）のフラグメントシェーダー
//  ・テクスチャカラー + 距離フォグ（簡易版）
//======================================================================


//======================================================================
//  頂点シェーダーからの入力
//======================================================================
in vec2 fragTexCoord;   // UV 座標
in vec3 fragWorldPos;   // 頂点のワールド座標


//======================================================================
//  出力カラー
//======================================================================
out vec4 outColor;


//======================================================================
//  Uniforms
//======================================================================

// ビルボードのテクスチャ
uniform sampler2D uTexture;

// カメラ位置（フォグ計算用）
uniform vec3 uCameraPos;

//----------------------------------------------------------
// フォグ情報
// minDist〜maxDist の間で線形フォグを計算する
//----------------------------------------------------------
struct FogInfo {
    float maxDist;   // フォグが完全にかかる距離
    float minDist;   // フォグが全くかからない距離
    vec3 color;      // フォグの色
};

uniform FogInfo uFoginfo;


//======================================================================
//  main()
//======================================================================
void main()
{
    //------------------------------------------------------------------
    // Step 1 : フォグ計算（距離ベース）
    //------------------------------------------------------------------
    float dist = length(uCameraPos - fragWorldPos);

    // 距離を 0.0〜1.0 にマッピング
    float fogFactor = (uFoginfo.maxDist - dist) /
                      (uFoginfo.maxDist - uFoginfo.minDist);

    fogFactor = clamp(fogFactor, 0.0f, 1.0f);


    //------------------------------------------------------------------
    // Step 2 : テクスチャ色取得
    //------------------------------------------------------------------
    vec4 sampled = texture(uTexture, fragTexCoord);


    //------------------------------------------------------------------
    // Step 3 : フォグ適用（fogFactor=0 → フォグ色、1 → テクスチャ色）
    //------------------------------------------------------------------
    vec3 finalColor = mix(uFoginfo.color, sampled.rgb, fogFactor);


    //------------------------------------------------------------------
    // Step 4 : 出力
    //------------------------------------------------------------------
    outColor = vec4(finalColor, sampled.a);
}
