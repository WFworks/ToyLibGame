#version 410 core

//======================================================================
//  Billboard.vert
//  ・ビルボード用（常にカメラへ正面を向く 2D スプライト）
//  ・各頂点を uPosition からの相対位置として扱う
//  ・法線は不要（ライティングをしない想定）
//======================================================================


//======================================================================
//  Uniforms
//======================================================================

// モデル行列（ワールド変換）
uniform mat4 uWorldTransform;

// ビュー・プロジェクション行列
uniform mat4 uViewProj;

// ビルボードの中心座標（ワールド空間）
// inPosition は中心からのオフセット（-0.5～+0.5）を想定
uniform vec3 uPosition;


//======================================================================
//  Attributes（頂点属性）
//======================================================================
layout(location = 0) in vec3 inPosition;   // ローカル座標（中心からのズレ）
layout(location = 1) in vec3 inNormal;     // 未使用（ビルボードはライティングしない）
layout(location = 2) in vec2 inTexCoord;   // UV


//======================================================================
//  Fragment Shader へ渡す値
//======================================================================
out vec2 fragTexCoord;
out vec3 fragWorldPos;


//======================================================================
//  main
//======================================================================
void main()
{
    //------------------------------------------------------------------
    // Step 1 : ビルボード中心 + 頂点オフセット
    //------------------------------------------------------------------
    // inPosition は [-0.5, +0.5] のローカル空間（四角形の頂点）
    vec3 worldPos = inPosition + uPosition;


    //------------------------------------------------------------------
    // Step 2 : ワールド変換（※Billboard 用なので回転成分は使わない想定）
    //------------------------------------------------------------------
    vec4 pos = vec4(worldPos, 1.0);
    pos = pos * uWorldTransform;


    //------------------------------------------------------------------
    // Step 3 : フラグメントシェーダーへワールド座標渡す
    //------------------------------------------------------------------
    fragWorldPos = pos.xyz;


    //------------------------------------------------------------------
    // Step 4 : カメラへの投影
    //------------------------------------------------------------------
    gl_Position = pos * uViewProj;


    //------------------------------------------------------------------
    // Step 5 : UV をそのまま出力
    //------------------------------------------------------------------
    fragTexCoord = inTexCoord;
}
